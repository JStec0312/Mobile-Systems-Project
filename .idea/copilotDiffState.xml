<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/petcare/domain/use_case/add_pet_by_key/AddPetByKeyUseCase.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/petcare/domain/use_case/add_pet_by_key/AddPetByKeyUseCase.kt" />
              <option name="originalContent" value="package com.example.petcare.domain.use_case.add_pet_by_key&#10;&#10;import com.example.petcare.common.Resource&#10;import com.example.petcare.common.utils.DateConverter&#10;import com.example.petcare.data.dto.PetShareCodeDto&#10;import com.example.petcare.domain.model.PetMember&#10;import com.example.petcare.domain.model.PetShareCode&#10;import com.example.petcare.domain.providers.IPetProvider&#10;import com.example.petcare.domain.providers.IUserProvider&#10;import com.example.petcare.domain.repository.IPetMemberRepository&#10;import com.example.petcare.domain.repository.IPetShareCodeRepository&#10;import com.example.petcare.exceptions.Failure&#10;import com.example.petcare.exceptions.GeneralFailure&#10;import kotlinx.coroutines.delay&#10;import kotlinx.coroutines.flow.Flow&#10;import kotlinx.coroutines.flow.flow&#10;import java.util.UUID&#10;import javax.inject.Inject&#10;&#10;class AddPetByKeyUseCase @Inject constructor(&#10;    private val userProvider: IUserProvider,&#10;    private val petProvider: IPetProvider ,&#10;    private val petShareCodeRepository: IPetShareCodeRepository,&#10;    private val petMememberRepository: IPetMemberRepository&#10;) {&#10;    operator fun invoke(&#10;        petKey: String,&#10;    ): Flow&lt;Resource&lt;Unit&gt;&gt; = flow {&#10;        emit(Resource.Loading())&#10;        try {&#10;            val userId = userProvider.getUserId();&#10;            if (userId == null){&#10;                emit(Resource.Error(&quot;User not logged in&quot;))&#10;                return@flow&#10;            }&#10;            val petShareCode: PetShareCode? = petShareCodeRepository.getPetShareCodeByValue(shareCode = petKey)&#10;            if (petShareCode == null){&#10;                emit(Resource.Error(&quot;Invalid pet key&quot;))&#10;                return@flow&#10;            }&#10;&#10;            if (petShareCode.expiresAt &lt; DateConverter.instantNow()){&#10;                emit(Resource.Error(&quot;Pet key has expired&quot;))&#10;                return@flow&#10;            }&#10;            val petMember: PetMember = PetMember(&#10;                id = UUID.randomUUID().toString(),&#10;                petId = petShareCode.petId,&#10;                userId = userId,&#10;                createdAt = DateConverter.localDateNow(),&#10;            )&#10;            petMememberRepository.addPetMember(petMember)&#10;            petShareCodeRepository.deletePetShareCodeById(petShareCode.id)&#10;            emit(Resource.Success(Unit))&#10;            return@flow&#10;        } catch (e: Failure) {&#10;            emit(Resource.Error(e.message))&#10;            return@flow&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.petcare.domain.use_case.add_pet_by_key&#10;&#10;import com.example.petcare.common.Resource&#10;import com.example.petcare.common.utils.DateConverter&#10;import com.example.petcare.domain.model.PetMember&#10;import com.example.petcare.domain.model.PetShareCode&#10;import com.example.petcare.domain.providers.IPetProvider&#10;import com.example.petcare.domain.providers.IUserProvider&#10;import com.example.petcare.domain.repository.IPetMemberRepository&#10;import com.example.petcare.domain.repository.IPetShareCodeRepository&#10;import com.example.petcare.exceptions.Failure&#10;import com.example.petcare.exceptions.GeneralFailure&#10;import kotlinx.coroutines.delay&#10;import kotlinx.coroutines.flow.Flow&#10;import kotlinx.coroutines.flow.flow&#10;import java.util.UUID&#10;import javax.inject.Inject&#10;&#10;class AddPetByKeyUseCase @Inject constructor(&#10;    private val userProvider: IUserProvider,&#10;    private val petProvider: IPetProvider ,&#10;    private val petShareCodeRepository: IPetShareCodeRepository,&#10;    private val petMememberRepository: IPetMemberRepository&#10;) {&#10;    operator fun invoke(&#10;        petKey: String,&#10;    ): Flow&lt;Resource&lt;Unit&gt;&gt; = flow {&#10;        emit(Resource.Loading())&#10;        try {&#10;            val userId = userProvider.getUserId();&#10;            if (userId == null){&#10;                emit(Resource.Error(&quot;User not logged in&quot;))&#10;                return@flow&#10;            }&#10;            val petShareCode: PetShareCode? = petShareCodeRepository.getPetShareCodeByValue(shareCode = petKey)&#10;            if (petShareCode == null){&#10;                emit(Resource.Error(&quot;Invalid pet key&quot;))&#10;                return@flow&#10;            }&#10;&#10;            if (petShareCode.expiresAt &lt; DateConverter.instantNow()){&#10;                emit(Resource.Error(&quot;Pet key has expired&quot;))&#10;                return@flow&#10;            }&#10;            val petMember: PetMember = PetMember(&#10;                id = UUID.randomUUID().toString(),&#10;                petId = petShareCode.petId,&#10;                userId = userId,&#10;                createdAt = DateConverter.localDateNow(),&#10;            )&#10;            petMememberRepository.addPetMember(petMember)&#10;            petShareCodeRepository.deletePetShareCodeById(petShareCode.id)&#10;            emit(Resource.Success(Unit))&#10;            return@flow&#10;        } catch (e: Failure) {&#10;            emit(Resource.Error(e.message))&#10;            return@flow&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/petcare/domain/use_case/edit_pet/EditPetUseCase.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/petcare/domain/use_case/edit_pet/EditPetUseCase.kt" />
              <option name="originalContent" value="package com.example.petcare.domain.use_case.edit_pet&#10;import com.example.petcare.common.Resource&#10;import com.example.petcare.common.sexEnum&#10;import com.example.petcare.common.speciesEnum&#10;import com.example.petcare.data.dto.PetDto&#10;import com.example.petcare.domain.model.Pet&#10;import com.example.petcare.domain.providers.IPetProvider&#10;import com.example.petcare.domain.providers.IUserProvider&#10;import com.example.petcare.domain.repository.IPetRepository&#10;import com.example.petcare.exceptions.Failure&#10;import com.example.petcare.exceptions.GeneralFailure&#10;import kotlinx.coroutines.delay&#10;import kotlinx.coroutines.flow.Flow&#10;import kotlinx.coroutines.flow.flow&#10;import kotlinx.datetime.LocalDate&#10;import timber.log.Timber&#10;import javax.inject.Inject&#10;&#10;class EditPetUseCase @Inject constructor(&#10;    private val userProvider: IUserProvider,&#10;    private val petProvider: IPetProvider,&#10;    private val petRepository: IPetRepository&#10;) {&#10;    operator fun invoke(&#10;        petId: String,&#10;        ownerUserId : String,&#10;        name: String?,&#10;        species: speciesEnum?,&#10;        breed: String?,&#10;        sex: sexEnum?,&#10;        birthDate: LocalDate?,&#10;        avatarThumbUrl: String?,&#10;        byteArrayImage: ByteArray?&#10;    ): Flow&lt;Resource&lt;Pet&gt;&gt; = flow {&#10;        emit(Resource.Loading())&#10;        try{&#10;            val petId = petId;&#10;            val userId: String? = userProvider.getUserId();&#10;            if (userId==null){&#10;                emit(Resource.Error(&quot;User not logged in&quot;))&#10;                return@flow&#10;            }&#10;&#10;            Timber.tag(&quot;EditPetUseCase&quot;).d(&quot;Editing pet with ID: $petId, owner id: $ownerUserId by user: $userId&quot;)&#10;&#10;            val petFromDb = petRepository.getPetById(petId)&#10;            if (petFromDb.ownerUserId!= userId){&#10;                Timber.tag(&quot;EditPetUseCase&quot;).d(&quot;User id: $userId is not owner of pet with id: $petId, owner id: $ownerUserId&quot;)&#10;                emit(Resource.Error(&quot;You are not an owner of the pet&quot;))&#10;                return@flow&#10;            }&#10;            val pet = Pet(&#10;                id = petId,&#10;                ownerUserId = ownerUserId,&#10;                name = name ?: petFromDb.name,&#10;                species = species ?: petFromDb.species,&#10;                breed = breed ?: petFromDb.breed,&#10;                sex = sex ?: petFromDb.sex,&#10;                birthDate = birthDate ?: petFromDb.birthDate,&#10;                avatarThumbUrl = avatarThumbUrl ?: petFromDb.avatarThumbUrl,&#10;                createdAt = petFromDb.createdAt,&#10;            )&#10;            val newPet: Pet = petRepository.editPet(pet, byteArrayImage)&#10;            emit(Resource.Success(newPet))&#10;            return@flow&#10;        } catch (e: Failure){&#10;            emit(Resource.Error(e.message))&#10;            return@flow&#10;        } catch(e: GeneralFailure.PetNotFound){&#10;            emit(Resource.Error(&quot;Pet not found&quot;))&#10;            return@flow&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.petcare.domain.use_case.edit_pet&#10;import com.example.petcare.common.Resource&#10;import com.example.petcare.common.sexEnum&#10;import com.example.petcare.common.speciesEnum&#10;import com.example.petcare.domain.model.Pet&#10;import com.example.petcare.domain.providers.IPetProvider&#10;import com.example.petcare.domain.providers.IUserProvider&#10;import com.example.petcare.domain.repository.IPetRepository&#10;import com.example.petcare.exceptions.Failure&#10;import com.example.petcare.exceptions.GeneralFailure&#10;import kotlinx.coroutines.delay&#10;import kotlinx.coroutines.flow.Flow&#10;import kotlinx.coroutines.flow.flow&#10;import kotlinx.datetime.LocalDate&#10;import timber.log.Timber&#10;import javax.inject.Inject&#10;&#10;class EditPetUseCase @Inject constructor(&#10;    private val userProvider: IUserProvider,&#10;    private val petProvider: IPetProvider,&#10;    private val petRepository: IPetRepository&#10;) {&#10;    operator fun invoke(&#10;        petId: String,&#10;        ownerUserId : String,&#10;        name: String?,&#10;        species: speciesEnum?,&#10;        breed: String?,&#10;        sex: sexEnum?,&#10;        birthDate: LocalDate?,&#10;        avatarThumbUrl: String?,&#10;        byteArrayImage: ByteArray?&#10;    ): Flow&lt;Resource&lt;Pet&gt;&gt; = flow {&#10;        emit(Resource.Loading())&#10;        try{&#10;            val petId = petId;&#10;            val userId: String? = userProvider.getUserId();&#10;            if (userId==null){&#10;                emit(Resource.Error(&quot;User not logged in&quot;))&#10;                return@flow&#10;            }&#10;&#10;            Timber.tag(&quot;EditPetUseCase&quot;).d(&quot;Editing pet with ID: $petId, owner id: $ownerUserId by user: $userId&quot;)&#10;&#10;            val petFromDb = petRepository.getPetById(petId)&#10;            if (petFromDb.ownerUserId!= userId){&#10;                Timber.tag(&quot;EditPetUseCase&quot;).d(&quot;User id: $userId is not owner of pet with id: $petId, owner id: $ownerUserId&quot;)&#10;                emit(Resource.Error(&quot;You are not an owner of the pet&quot;))&#10;                return@flow&#10;            }&#10;            val pet = Pet(&#10;                id = petId,&#10;                ownerUserId = ownerUserId,&#10;                name = name ?: petFromDb.name,&#10;                species = species ?: petFromDb.species,&#10;                breed = breed ?: petFromDb.breed,&#10;                sex = sex ?: petFromDb.sex,&#10;                birthDate = birthDate ?: petFromDb.birthDate,&#10;                avatarThumbUrl = avatarThumbUrl ?: petFromDb.avatarThumbUrl,&#10;                createdAt = petFromDb.createdAt,&#10;            )&#10;            val newPet: Pet = petRepository.editPet(pet, byteArrayImage)&#10;            emit(Resource.Success(newPet))&#10;            return@flow&#10;        } catch (e: Failure){&#10;            emit(Resource.Error(e.message))&#10;            return@flow&#10;        } catch(e: GeneralFailure.PetNotFound){&#10;            emit(Resource.Error(&quot;Pet not found&quot;))&#10;            return@flow&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>